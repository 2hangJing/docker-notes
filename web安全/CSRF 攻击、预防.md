<!--
 * @Author: monai
 * @Date: 2020-05-20 17:58:48
 * @LastEditors: monai
 * @LastEditTime: 2020-05-21 18:44:13
--> 
# CSFR 是什么？

CSFR 是跨站请求伪造攻击（Cross-site request forgery）的缩写。CSFR 攻击原理如下：
1. 用户登陆 a.com ，a.com 返回用户的登陆凭证 cookie。
2. 诱导用户进入 b.com ，b.com 直接跨域请求 a.com ，并携带 a.com 的 cookie。
3. a.com 误认为是 用户自己操作，用户数据被修改、信息泄露。

## XSS 分类

XSS 没有规定的分类，网上查到基本都是：反射型、存储型、DOM 型三类。为了方便理解我个人分为两大类：存储型、非存储型，或者 DMO 型、非 DOM 型。  

#### 按照存储型分类：
1. 存储型：攻击者利用例如留言板模块，将攻击代码注入到网站数据库中，其他用户只要打开有留言列表网页都会被攻击。
2. 非存储型：攻击者制造一个带有恶意代码的 URL ，用户点击后 URL 上的恶意代码被执行。其他用户访问正常的 URL 没有问题。

#### 按照恶意代码渲染位置分类：
1. DOM 型：用户访问 URL 后，服务端返回静态文件，前端通过 js 渲染页面，其中 img 通过动态的 src、js 通过 `innerHTML` 等，导致恶意代码执行，用户信息泄露，被攻击。
2. 非 DOM 型：用户访问 URL 后，服务端渲染页面，前端直接展示，导致恶意代码被执行，用户信息泄露，被攻击。

## XSS 预防.

预防 XSS 攻击主要有两点：
1. 一个是输入过程对字符串中相关敏感字符过滤，避免恶意代码被存储到数据库，从而导致大面积页面都被污染。
2. 一个是写代码过程中要注意。前端渲染时 `innerHTML`，`setTimeout()` 这种拼接字符串要小心，因为这些操作都可以将字符串当yi作代码运行。而在服务端渲染时，`<a href="">`，`<img src="">` 与内联事件 `onlick`，`onmouseover` 等拼接字符串时要小心，避免将未转义的代码直接拼接。

其他的方式呢？
1. 服务端给敏感 cookie 设置 http-only 防止网站被攻击后通过 JS 拿到用户的 cookie ，从而模拟用户伪造请求。
2. 用户的重要操作增加短信验证码验证身份。
3. 对用户输入的表单增加长度限制，虽然不可靠，但是增加了 XSS 攻击的难度。
